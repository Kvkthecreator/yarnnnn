import { BRAND } from "@/lib/metadata";
import { getAllPosts } from "@/lib/blog";

export async function GET() {
  const posts = getAllPosts();
  const lines = [
    `# ${BRAND.name}`,
    "",
    `> ${BRAND.tagline}`,
    "",
    "## What this site is",
    "",
    `${BRAND.name} is home to TP (Thinking Partner) — your autonomous AI agent. TP connects to your Slack, Gmail, Notion, and Calendar, accumulates context continuously, and produces recurring deliverables on your behalf. Unlike other agents that start from zero every session, TP gets smarter the longer you use it.`,
    "",
    "Core concept: TP is an AI agent that already knows your work. You brief TP in plain language — \"weekly status report for Sarah\" or \"monthly investor update\" — and TP sets up autonomous deliverables, produces them on schedule, and learns from every edit. You supervise. TP operates.",
    "",
    "## Key pages",
    "",
    `- [Home](${BRAND.url}): Meet TP — your autonomous AI agent that already knows your work`,
    `- [How It Works](${BRAND.url}/how-it-works): How TP works — brief your agent, give it access, review what it produces`,
    `- [Pricing](${BRAND.url}/pricing): Free (1 deliverable, unlimited connections) and Pro ($19/mo, unlimited)`,
    `- [FAQ](${BRAND.url}/faq): 19 questions covering platforms, data safety, deliverables, pricing, and getting started`,
    `- [About](${BRAND.url}/about): Why we built TP — every AI agent starts from zero, so we built one that doesn't`,
    `- [Blog](${BRAND.url}/blog): Ideas on context-powered AI agents and autonomous work`,
    "",
    "## How TP works",
    "",
    "1. Brief your agent — tell TP what you need in plain language",
    "2. Give TP access to your world — connect Slack, Gmail, Notion, Calendar via OAuth",
    "3. TP syncs context continuously and produces deliverables on schedule",
    "4. You review, edit, and approve — every cycle teaches TP your preferences",
    "5. After 90 days, TP's accumulated context makes it irreplaceable",
    "",
    "## Why TP is different from other agents",
    "",
    "- Other agents reset every session. TP accumulates context continuously.",
    "- Other agents need detailed prompts. TP already knows your work.",
    "- Other agents execute blindly. TP works from your conversations, decisions, and patterns.",
    "- The longer you use TP, the better it gets. That's the moat.",
    "",
    "## Platforms supported",
    "",
    "- Slack: channel messages, thread expansion",
    "- Gmail: emails by label",
    "- Google Calendar: events (-7d to +14d)",
    "- Notion: pages and databases",
    "",
    "## Pricing",
    "",
    "- Free: 1 autonomous deliverable, unlimited platform connections, 10 TP conversations/month",
    "- Pro ($19/month): unlimited deliverables, unlimited conversations, priority support",
    "",
    "## Feeds and discovery",
    "",
    `- Blog: ${BRAND.url}/blog`,
    `- RSS: ${BRAND.url}/blog/rss.xml`,
    `- Sitemap: ${BRAND.url}/sitemap.xml`,
    `- FAQ: ${BRAND.url}/faq`,
    "",
    "## Recent blog posts",
    "",
    ...posts.slice(0, 20).map((post) => `- [${post.title}](${post.canonicalUrl}): ${post.description}`),
    "",
  ];

  return new Response(lines.join("\n"), {
    headers: {
      "Content-Type": "text/plain; charset=utf-8",
      "Cache-Control": "public, max-age=3600",
    },
  });
}
