import { BRAND } from "@/lib/metadata";
import { getAllPosts } from "@/lib/blog";

export async function GET() {
  const posts = getAllPosts();
  const lines = [
    `# ${BRAND.name}`,
    "",
    `> ${BRAND.tagline}`,
    "",
    "## What this site is",
    "",
    `${BRAND.name} is an autonomous AI work platform. It connects to your Slack, Gmail, Notion, and Calendar, accumulates context continuously, and produces recurring deliverables on your behalf. The longer you use it, the smarter it gets.`,
    "",
    "Core concept: you describe what you need to TP (Thinking Partner) in plain language. yarnnn sets up autonomous deliverables — weekly reports, client briefs, investor updates — and produces them on schedule. You review and approve. Every edit teaches yarnnn your preferences.",
    "",
    "## Key pages",
    "",
    `- [Home](${BRAND.url}): Product overview and how it works`,
    `- [How It Works](${BRAND.url}/how-it-works): Meet TP, the three pillars, and the autonomous flow`,
    `- [Pricing](${BRAND.url}/pricing): Free (1 deliverable, unlimited connections) and Pro ($19/mo, unlimited)`,
    `- [FAQ](${BRAND.url}/faq): 19 questions covering platforms, data safety, deliverables, pricing, and getting started`,
    `- [About](${BRAND.url}/about): Why yarnnn was built and who it's for`,
    `- [Blog](${BRAND.url}/blog): Ideas on context-powered AI and autonomous work`,
    "",
    "## How yarnnn works",
    "",
    "1. Connect your work platforms (Slack, Gmail, Notion, Calendar) via OAuth",
    "2. Talk to TP to set up recurring deliverables",
    "3. yarnnn syncs context continuously and produces drafts on schedule",
    "4. You review, edit, and approve — each cycle improves quality",
    "5. After 90 days, accumulated context makes the output irreplaceable",
    "",
    "## Platforms supported",
    "",
    "- Slack: channel messages, thread expansion",
    "- Gmail: emails by label",
    "- Google Calendar: events (-7d to +14d)",
    "- Notion: pages and databases",
    "",
    "## Pricing",
    "",
    "- Free: 1 autonomous deliverable, unlimited platform connections, 10 TP conversations/month",
    "- Pro ($19/month): unlimited deliverables, unlimited conversations, priority support",
    "",
    "## Feeds and discovery",
    "",
    `- Blog: ${BRAND.url}/blog`,
    `- RSS: ${BRAND.url}/blog/rss.xml`,
    `- Sitemap: ${BRAND.url}/sitemap.xml`,
    `- FAQ: ${BRAND.url}/faq`,
    "",
    "## Recent blog posts",
    "",
    ...posts.slice(0, 20).map((post) => `- [${post.title}](${post.canonicalUrl}): ${post.description}`),
    "",
  ];

  return new Response(lines.join("\n"), {
    headers: {
      "Content-Type": "text/plain; charset=utf-8",
      "Cache-Control": "public, max-age=3600",
    },
  });
}
